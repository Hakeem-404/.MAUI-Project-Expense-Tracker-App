<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    x:Class="ExpenseMauiApp.Views.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Projects">
    
    <ContentPage.Resources>
        <Style TargetType="Frame">
            <Setter Property="VisualStateManager.VisualStateGroups">
                <VisualStateGroupList>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal" />
                        <VisualState x:Name="Selected">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor"
                                        Value="LightSkyBlue" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateGroupList>
            </Setter>
        </Style>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Database Status Banner (Commented out for now)
        <Frame Grid.Row="0" Padding="10,5" BackgroundColor="#E3F2FD" BorderColor="#BBDEFB" 
               CornerRadius="0" IsVisible="{Binding IsDatabaseStatusVisible}">
            <StackLayout Orientation="Horizontal" Spacing="10">
                <Image Source="database_icon.png" WidthRequest="20" HeightRequest="20" 
                       VerticalOptions="Center" IsVisible="false"/>
                <Label Text="{Binding DatabaseStatusMessage}" 
                       TextColor="#1976D2" VerticalOptions="Center" 
                       FontSize="14" x:Name="databaseStatusLabel"/>
            </StackLayout>
        </Frame> -->

        <!-- Search Bar -->
        <SearchBar x:Name="searchBar"
                   Placeholder="Search projects"
                   TextChanged="OnSearchBarTextChanged"
                   Grid.Row="1" />

        <!-- Projects Collection View -->
        <CollectionView x:Name="projectsCollectionView" 
                        SelectionMode="Single"
                        SelectionChanged="OnProjectSelected"
                        ItemsSource="{Binding Projects}"
                        Grid.Row="2">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="5" Padding="10" 
                           BorderColor="#E0E0E0" 
                           CornerRadius="8">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnFrameTapped" 
                                                 CommandParameter="{Binding .}" />
                        </Frame.GestureRecognizers>
                        <Grid RowSpacing="5" ColumnSpacing="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Star icon for favorites -->
                            <Label Grid.Row="0" Grid.Column="0" 
                                Text="★" 
                                TextColor="#FFC107"
                                FontSize="24"
                                IsVisible="{Binding IsFavorite}"
                                VerticalOptions="Start" />

                            <!-- Project Name - Primary Information -->
                            <Label Text="{Binding ProjectName}" 
                                   Grid.Row="0" Grid.Column="1"
                                   FontAttributes="Bold" 
                                   TextColor="#673AB7"
                                   FontSize="18"/>
                            
                            <!-- Project ID -->
                            <StackLayout Grid.Row="1" Grid.Column="1" Orientation="Horizontal">
                                <Label Text="ID: " FontAttributes="Bold" FontSize="14" TextColor="#757575"/>
                                <Label Text="{Binding ProjectID}" FontSize="14" TextColor="#757575"/>
                            </StackLayout>
                            
                            <!-- Project Manager -->
                            <StackLayout Grid.Row="2" Grid.Column="1" Orientation="Horizontal">
                                <Label Text="Manager: " FontAttributes="Bold" FontSize="14"/>
                                <Label Text="{Binding Manager}" FontSize="14"/>
                            </StackLayout>
                            
                            <!-- Project Status -->
                            <StackLayout Grid.Row="3" Grid.Column="1" Orientation="Horizontal">
                                <Label Text="Status: " FontAttributes="Bold" FontSize="14"/>
                                <Label Text="{Binding ProjectStatus}" TextColor="#4CAF50"/>
                            </StackLayout>

                            <!-- Budget - Right Side -->
                            <StackLayout Grid.Row="0" Grid.Column="2" Grid.RowSpan="2"
                                       HorizontalOptions="End" VerticalOptions="Center">
                                <Label Text="Budget: " FontAttributes="Bold" FontSize="14" 
                                       HorizontalOptions="End"/>
                                <Label Text="{Binding Budget, StringFormat='£{0:N2}'}" 
                                       FontAttributes="Bold" 
                                       TextColor="#4CAF50"
                                       HorizontalOptions="End"/>
                            </StackLayout>
                            
                            <!-- Dates - Right Side -->
                            <StackLayout Grid.Row="2" Grid.Column="2" Grid.RowSpan="2"
                                       HorizontalOptions="End" VerticalOptions="Center">
                                <StackLayout Orientation="Horizontal" HorizontalOptions="End">
                                    <Label Text="Start Date: " FontAttributes="Bold" FontSize="12"/>
                                    <Label Text="{Binding StartDate, StringFormat='{0:dd/MM/yyyy}'}" 
                                           FontSize="12"/>
                                </StackLayout>
                                <StackLayout Orientation="Horizontal" HorizontalOptions="End">
                                    <Label Text="End Date: " FontAttributes="Bold" FontSize="12"/>
                                    <Label Text="{Binding EndDate, StringFormat='{0:dd/MM/yyyy}'}" 
                                           FontSize="12"/>
                                </StackLayout>
                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            <CollectionView.EmptyView>
                <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                    <Label Text="No projects available" FontSize="18" HorizontalTextAlignment="Center" />
                    <Label Text="Please connect to the database" FontSize="14" HorizontalTextAlignment="Center" />
                </StackLayout>
            </CollectionView.EmptyView>
        </CollectionView>
        
        <!-- Activity Indicator -->
        <ActivityIndicator x:Name="activityIndicator" IsRunning="False" 
                           Grid.Row="2" HorizontalOptions="Center" VerticalOptions="Center" />
        
        <!-- Status Area at Bottom -->
        <StackLayout Grid.Row="3" BackgroundColor="#F5F5F5" Padding="10,5">
            <Label x:Name="statusLabel" Text="Ready" FontSize="12" TextColor="#757575"/>
        </StackLayout>
    </Grid>
</ContentPage>